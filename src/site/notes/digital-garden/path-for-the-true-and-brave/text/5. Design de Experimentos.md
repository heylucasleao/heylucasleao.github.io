---
{"dg-publish":true,"permalink":"/digital-garden/path-for-the-true-and-brave/text/5-design-de-experimentos/"}
---

# Design de Experimentos

Na introdução ao seu trabalho [The Design of Experiments](https://home.iitk.ac.in/~shalab/anova/DOE-RAF.pdf), Ronald Fisher demonstrou preocupação com a falta de clareza e rigor metodológico em experimentos. Ele notou que a ausência de um design experimental robusto poderia levar a:

- **Dificuldade de Interpretação:** O leitor e, por vezes, o próprio cientista, poderiam ter percepções diferentes sob os resultados, levando a conclusões que não eram suportadas pelos dados, ou que poderiam ter ocorrido **por acaso** (chance), mesmo que a hipótese fosse falsa.
- **Carência Estrutural (Design):** Falhas lógicas e estruturais, com o experimento sendo **fundamentalmente incorreto**, muitas vezes devido a controles inadequados ou à ausência de comparação válida.

Fisher propôs um método rigoroso que visa trazer **facilidade** e **confiança** ao cientista no tópico de experimentação, desde o planejamento (*design*) até o desenvolvimento e análise.

>Conceitos Chave de Fisher:
> - **Randomização:** Para garantir que as características não observáveis se distribuam igualmente.
> - **Controle:** Para isolar o efeito do tratamento.
> - **Replicação:** Para reduzir o erro experimental e aumentar a precisão.

# Experimentos Aleatorizados

Para contornar o Problema Fundamental da Inferência Causal, carência de design de experimentos e controlar viés de variável omitida, recorre-se a métodos de pesquisa como o Experimento Aleatorizado. 

O experimento aleatorizado, ou ensaio clínico randomizado (RCT), é um procedimento no qual as unidades de uma amostra populacional são alocadas de forma aleatória*(randomizada) ao grupo de tratamento ou ao grupo de controle.

A randomização é crucial, pois:
- Elimina vieses de seleção e confusão.
- Cria grupos estatisticamente comparáveis.

Ao garantir que a única diferença sistemática esperada entre os grupos é a aplicação do tratamento, a randomização permite que a **diferença observacional** nos resultados seja interpretada como uma **estimativa válida do efeito causal** médio do tratamento na população.

> [!tip]
	> Mesmo assim, RCT não é uma bala de prata. Existem premissas importantes em estudos observacionais que **precisam** ser respeitas também em RCT. Muitas das vezes, ela de fato é, mas é importante termos conhecimento delas:
	>- SUTVA (Stable Unit Treatment Value Assumption)
    > 	- Consistência: o tratamento é bem definido; o outcome observado para uma unidade sob o tratamento t é igual ao potencial outcome Y(t).
	>	- Sem interferência: o tratamento de uma unidade não afeta o outcome de outra (sem spillovers/efeitos indiretos).
	>- Ignorabilidade / Unconfoundedness / Exchangeability
    >	- Os potenciais outcomes são independentes do tratamento, condicional às covariáveis observadas: ${Y(0), Y(1)} ⟂ T | X$. Em RCTs a randomização garante ignorabilidade em expectativa.
	>- Positividade / Overlap
    >	- Para todo valor de X considerado, há probabilidade estritamente positiva de receber cada condição: 0 < P(T=1 | X) < 1. Sem positividade não é possível comparar contrafactuais em certas subpopulações.
    >- Controle de confundidores 
    >	- Em estudos observacionais: medir e ajustar os confundidores (regressão, propensity scores, IPW, matching, estratificação, etc.).
    >	- Em RCTs: projetar blocos/estratificação quando necessário e checar balanceamento pré-tratamento; ajustar para covariáveis quando melhora precisão.
	>- Ameaça pós-randomização
    >	- Não-adesão (noncompliance), perda amostral diferencial (attrition), contaminação e mediadores induzidos por tratamento podem reintroduzir viés.

> [!tip]
> Checagens práticas recomendadas
> - Verificar balanceamento de covariáveis pré-tratamento (tabelas/estadísticas e testes; love plot).
> - Conferir overlap/propensity score distributions e excluir regiões sem suporte comum.
> - Monitorar taxas de adesão e perda.

![rct_1.png](/img/user/digital-garden/path-for-the-true-and-brave/assets/rct_1.png)
[Lecture 3 – The Magic of Randomized Control Trials](https://stanford-causal-inference-class.github.io/materials/lecture-slides/Unit1_Lecture1.pptx)

![rct_2.png](/img/user/digital-garden/path-for-the-true-and-brave/assets/rct_2.png)
[Lecture 3 – The Magic of Randomized Control Trials](https://stanford-causal-inference-class.github.io/materials/lecture-slides/Unit1_Lecture1.pptx)

> [!tip]
> Um bom artigo que podemos observar o carinho de um bom design de experimento e aleatorizada, é o artigo [The impact of computer usage on academic performance: Evidence from a randomized trial at the United States Military Academy](https://www.sciencedirect.com/science/article/abs/pii/S0272775716303454).
## Pontos de Atenção

- **Validação Interna:** Refere-se à confiança de que o efeito observado no resultado é **causado** unicamente pela manipulação do tratamento (a variável independente) e não por fatores externos, vieses ou erros de medição dentro do grupo de estudo. Um experimento tem alta validade interna se pudermos afirmar com certeza que o tratamento causou a mudança no resultado.
    - **Ponto de Atenção:** Ameaças à validade interna incluem a seleção dos participantes, a maturação (mudanças nos participantes ao longo do tempo), a história (eventos externos que ocorrem durante o experimento) e a mortalidade/abandono (perda de participantes).
- **Validação Externa:** Trata-se da capacidade de generalizar os resultados do experimento para a população mais ampla ou para outros ambientes e contextos. Se os resultados só se aplicarem à área de amostragem específica (demografia), a validade externa é baixa.
    - **Ponto de Atenção:** Ameaças à validade externa incluem a interação entre seleção e tratamento (o efeito só se aplica ao grupo selecionado) e os efeitos de laboratório (condições artificiais que não refletem o mundo real).
- **Validade de Construto**
    - **Definição:** Refere-se à adequação das medidas. Garante que as variáveis operacionais (as formas concretas de medir ou manipular as variáveis no seu experimento) realmente representam os construtos teóricos (os conceitos abstratos que você está estudando).
    - **Em outras palavras:** É a certeza de que o experimento está medindo aquilo que se propôs a medir.
    - **Ponto de Atenção:**
        - Deve-se garantir que as métricas realmente capturem a essência dos conceitos (ex: satisfação do cliente, motivação).
        - **Ameaças Comuns:**
            - **Sub-representação do Construto:** O teste não mede todos os aspectos do conceito (a medida é incompleta).
            - **Variância de Métodos Irrelevantes:** A medição é afetada por fatores não relacionados ao conceito que se deseja medir.
- **Efeito Spillover**
    - Ocorre quando o tratamento aplicado ao Grupo de Tratamento afeta, indiretamente, o Grupo de Controle (ou vice-versa). Isso é uma violação da suposição de que o resultado de uma unidade não é afetado pelo tratamento de outra (*SUTVA violation*). O tratamento "vaza" ou a informação/benefício se espalha.
        - **Exemplos:**
            - Em experimentos geográficos, o tratamento aplicado em uma área de teste afeta as pessoas em uma área de controle vizinha
            - Um participante do grupo de controle **aprende** sobre a nova funcionalidade com um amigo do grupo de tratamento (contaminação).
            - A mudança de preço em uma loja (grupo de tratamento) afeta a **demanda ou percepção** dos clientes de uma loja vizinha (grupo de controle).
            - Em experimentos geográficos, o tratamento aplicado em uma área de teste afeta as pessoas em uma área de controle vizinha.
        - **Implicação:** Se o *spillover* ocorrer, o Grupo de Controle não é mais uma verdadeira linha de base, o que compromete a validade intern. A estimativa do efeito causal do tratamento será **enviesada** (subestimada ou superestimada).
        - **Estratégias de Mitigação:** Usar grupos de controle **distantes** (geográfica ou socialmente) ou implementar **cegamento** (impedir que os participantes saibam quem recebeu o tratamento).

## Problemas com Experimentos Aleatorizados

Em um RCT, os participantes são distribuídos aleatoriamente para o grupo de tratamento ou controle. Essa randomização visa equilibrar todas as variáveis de confusão (tanto as conhecidas quanto as desconhecidas) entre os grupos, permitindo que qualquer diferença observada no resultado seja atribuída, com alta confiança, à intervenção (causa).

Embora seja o padrão de ouro na metodologia experimental, ele não oferece uma garantia absoluta de causalidade, pois a randomização inicial é apenas o primeiro passo. A causalidade pode ser comprometida por **vieses pós-randomização** que surgem durante a execução do estudo. Problemas como a desigualdade de características entre os participantes, perda ou até abandono podem prejudicar o resultado para uma generalização dos resultados.

Além das limitações metodológicas na condução do estudo, o RCT é inviável ou antiético em inúmeros cenários de pesquisa causal. Existem fenômenos de interesse (como o efeito de eventos raros, exposições de longuíssimo prazo, ou variáveis não manipuláveis, como o *status* socioeconômico) onde a aleatoriedade é inatingíve. Mais gravemente, a randomização é anti-étic em exposições que são sabidamente prejudiciais. Por exemplo, seria moralmente inaceitável randomizar uma população para forçar um grupo a fumar a fim de analisar as chances de câncer de pulmão.

Portanto, em contextos onde a intervenção não pode ser controlada por um RCT devido a impedimentos éticos ou práticos, os pesquisadores devem recorrer a outras ferramentas, como também é possível aplicar outros tipos de amostragens. 

## Experimentos Condicionalmente Aleatórios

Em amostras de tamanho limitado ou dependendo de cenários específicos, a aleatorização simples pode, por acaso, resultar em um desequilíbrio em covariáveis entre os grupos. Esse desequilíbrio pode levar a um viés de seleção e comprometer a validade interna do experimento. Para mitigar esse risco e equilibrar as características importantes na amostra, podemos utilizar métodos de Aleatorização Condicional. Um método mais simples e comumente utilizado, é a estratificação por covariáveis, isto é, dividir a população em subgrupos com base em que cada proporção e características sejam divididas entre o grupo de controle e tratamento. Ainda sim, há diversos outros meios.

## Elementos do Poder Estatístico

![hypothesis_test_1.png](/img/user/digital-garden/path-for-the-true-and-brave/assets/hypothesis_test_1.png)

No contexto de estudos experimentai, ainda estaremos trabalhando com testes de hipóteses, pois de fato estamos atuando com cenários nas quais queremos estudar. Isto implica que estamos ainda sujeitos a cometer erros estatísticos ao tomar uma decisão sobre a hipótese nula $H_0$.

### **Erros do Tipo I e Tipo II**

![hypothesis_test_2.png](/img/user/digital-garden/path-for-the-true-and-brave/assets/hypothesis_test_2.png)

**Erro do Tipo I (Falso Positivo)**:

Ocorre quando rejeitamos a $H_0$ quando ela é, na verdade, verdadeira. A probabilidade de cometer um Erro Tipo I é controlada pelo **nível de significância** $\alpha$.  Comumente o valor de $\alpha$ é utilizado em 0,05, o que significa que aceitamos 5% de chance de concluir erroneamente que há um efeito.


> [!tip]
> Neste contexto, seria concluir que o tratamento teve um efeito quando, na realidade, a diferença observada foi devida puramente ao acaso.

**Erro do Tipo II (Falso Negativo)**:

Ocorre quando falhamos em rejeitar a $H_0$ quando ela é, na verdade, falsa. A probabilidade de cometer um Erro Tipo II é controlado pelo poder de teste, $1 - \beta$.

> [!tip]
> Neste contexto, seria concluir que o tratamento não teve um efeito (ou que não houve diferença significativa) quando, na realidade, ele teve um efeito real na população.

### Análise de Poder Estatístico

É fundamental que façamos uma análise do poder, pois permite determinar o tamanho de amostra necessário para detectar um efeito de determinado tamanho com uma probabilidade aceitável. Os quatro termos inter-relacionados nesta análise são:

1. Tamanho da Amostra: O número de observações incluídas no estudo. Um aumento na amostra geralmente aumenta o Poder do Teste.
2. Nível de Significância $\alpha$: Se for **diminuído** (ex: de 0,05 para 0,01), a chance de um Falso Positivo diminui, mas a exigência para rejeitar $H_0$ é maior, o que, por sua vez, diminuindo a sensibilidade do Poder do Teste (aumentando $\beta$). 
3. Poder do Teste (**$1 - \beta$**): O poder de teste é a **sensibilidade** do estudo. Geralmente, o poder do teste é fixado em 0,80 (ou 80%), o que significa que se um efeito real existir, o estudo tem 80% de chance de detectá-lo.
4. Tamanho do Efeito (Effect Size - Cohen’s D) ou Efeito Mínimo Detectável (Minimum Detectable Effect - MDE): O Tamanho do Efeito é a magnitude da diferença ou relacionamento de interesse na população. O MDE é o menor tamanho de efeito que o estudo está equipado para detectar com as configurações de amostra, nível de significância e Poder do teste.
    - **Relação com o MDE**:
        - Se o MDE for muito alto (ex: 15%), o estudo é muito "grosseiro" e pode falhar em detectar efeitos menores, mas clinicamente ou economicamente relevantes (ex: 2%), resultando em um aumento da probabilidade do Erro Tipo II.
        - Para **reduzir o MDE** e, assim, aumentar a sensibilidade do estudo a efeitos menores, é necessário **aumentar o Tamanho da Amostra N.
	
	
 O MDE não deve ser um número arbitrário; ele deve ser o menor efeito que é economicamente ou clinicamente relevante para a sua área.  A Análise de Poder a Priori deve usar este MDE junto com o Poder e o Alpha para calcular o tamanho de amostra mínimo necessário. Se o tamanho da amostra for inviável para o MDE de interesse, o estudo deve ser repensado.

> [!tip]
> Segundo Ron Kovahi, se o MDE for menor que 5%, dificilmente você irá detectá-lo com confiança, junto ao fato da quantidade de amostras necessárias para verificar. O ideal será entre 5% a 10%. 
