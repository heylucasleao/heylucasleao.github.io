<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infográfico de Inferência Causal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen py-12 px-4 font-sans text-slate-900">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-slate-800 mb-4 tracking-tight">
                Caminho do Projeto de <span class="text-blue-600">Inferência Causal</span>
            </h1>
            <p class="text-lg text-slate-600">Guia de decisão para determinar a estratégia de estimativa de efeitos causais.</p>
            <div id="reset-container" class="hidden">
                <button onclick="resetFlow()" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 flex items-center gap-1 mx-auto">
                    Reiniciar Fluxo
                </button>
            </div>
        </header>

        <div id="app" class="flex flex-col items-center">
            <!-- O conteúdo será gerado dinamicamente pelo JavaScript -->
        </div>
    </div>

    <script>
        // Estado da aplicação
        let state = {
            randomized: null,
            assumptionsMet: null
        };

        // Função para atualizar o estado e renderizar
        function setState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function resetFlow() {
            state = { randomized: null, assumptionsMet: null };
            render();
        }

        // Templates de componentes
        function Step(title, description, content = '', iconName = 'info', type = 'info') {
            const colors = {
                success: 'border-green-500 bg-green-50 text-green-700',
                warning: 'border-amber-500 bg-amber-50 text-amber-700',
                error: 'border-rose-500 bg-rose-50 text-rose-700',
                gold: 'border-yellow-500 bg-yellow-50 text-yellow-800 shadow-lg',
                info: 'border-blue-500 bg-blue-50 text-blue-700'
            };

            return `
                <div class="p-4 rounded-xl border-2 mb-6 w-full max-w-2xl mx-auto transition-all hover:scale-[1.02] fade-in ${colors[type]}">
                    <div class="flex items-start gap-4">
                        <div class="p-2 rounded-lg bg-white shadow-sm">
                            <i data-lucide="${iconName}" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold mb-1">${title}</h3>
                            <p class="text-sm opacity-90 leading-relaxed mb-3">${description}</p>
                            ${content}
                        </div>
                    </div>
                </div>
            `;
        }

        function Connector() {
            return `<div class="flex justify-center my-2"><div class="w-0.5 h-8 bg-slate-300"></div></div>`;
        }

        function DecisionNode(question, opt1, opt2, currentValue) {
            const isYesSelected = currentValue === true;
            const isNoSelected = currentValue === false;
            const isNeutral = currentValue === null;

            // Lógica de cores baseada na seleção
            const btnYesClass = isYesSelected 
                ? 'bg-green-600 text-white shadow-inner scale-95' 
                : (isNeutral ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-slate-200 text-slate-400 opacity-60');
            
            const btnNoClass = isNoSelected 
                ? 'bg-rose-600 text-white shadow-inner scale-95' 
                : (isNeutral ? 'bg-slate-200 text-slate-700 hover:bg-slate-300' : 'bg-slate-200 text-slate-400 opacity-60');

            return `
                <div class="flex flex-col items-center gap-4 my-8 fade-in">
                    <div class="bg-slate-800 text-white px-6 py-4 rounded-full font-medium shadow-xl flex items-center gap-2 text-center">
                        <i data-lucide="help-circle" class="w-5 h-5 text-blue-400 shrink-0"></i>
                        ${question}
                    </div>
                    <div class="flex gap-4">
                        <button onclick="${opt1.action}" class="px-8 py-2 rounded-lg font-bold transition-all transform ${btnYesClass}">
                            ${opt1.label}
                        </button>
                        <button onclick="${opt2.action}" class="px-8 py-2 rounded-lg font-bold transition-all transform ${btnNoClass}">
                            ${opt2.label}
                        </button>
                    </div>
                </div>
            `;
        }

        // Função principal de renderização
        function render() {
            const app = document.getElementById('app');
            const resetBtn = document.getElementById('reset-container');
            let html = '';

            // Passo Inicial
            html += Step("Início: A Questão do Tratamento", "Defina sua variável de tratamento (X) e seu resultado de interesse (Y).", '', 'database');
            html += Connector();

            // Decisão 1
            html += DecisionNode(
                "O tratamento foi ou pode ser randomizado?",
                { label: "Sim", action: "setState({randomized: true})" },
                { label: "Não", action: "setState({randomized: false, assumptionsMet: null})" },
                state.randomized
            );

            if (state.randomized === true) {
                resetBtn.classList.remove('hidden');
                html += Connector();
                html += Step("Padrão de Ouro (Gold Standard)", "Experimentos Aleatórios Controlados (RCTs) resolvem viéses de seleção e confusão por design.", 
                    '<div class="bg-white/50 p-3 rounded-lg text-xs font-mono">Efeito Causal = E[Y|T=1] - E[Y|T=0]</div>', 
                    'check-circle-2', 'gold');
                html += Connector();
                html += Step("Traçar o DAG (Directed Acyclic Graph)", "Mesmo em RCTs, mapeie as relações para garantir que não haja vazamento de informação.", '', 'git-branch');
                html += `
                    <div class="mt-8 p-6 bg-green-600 text-white rounded-2xl text-center shadow-lg fade-in w-full max-w-2xl">
                        <h4 class="text-xl font-bold mb-2">Sucesso!</h4>
                        <p>Pode prosseguir com testes de diferença de médias ou regressões simples.</p>
                    </div>
                `;
            } else if (state.randomized === false) {
                resetBtn.classList.remove('hidden');
                html += Connector();
                html += Step("Dados Observacionais", "O tratamento foi decidido por critérios não-aleatórios. O risco de viés de seleção é alto.", '', 'search', 'warning');
                html += Connector();
                html += Step("Mapeamento Causal (DAG)", "Identifique quem afeta o tratamento e o resultado simultaneamente (Variáveis de Confusão).", '', 'git-branch');
                html += Connector();
                html += Step("Verificação de Premissas Críticas", "Para usar métodos padrão de ajuste, precisamos garantir três pilares:", `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-2">
                        <div class="p-2 bg-white rounded border border-amber-200 text-xs text-slate-700"><span class="font-bold block">1. Confusão</span>Identificada e medida.</div>
                        <div class="p-2 bg-white rounded border border-amber-200 text-xs text-slate-700"><span class="font-bold block">2. SUTVA</span>Sem interferência entre unidades.</div>
                        <div class="p-2 bg-white rounded border border-amber-200 text-xs text-slate-700"><span class="font-bold block">3. Positividade</span>Chance > 0 para todos.</div>
                    </div>
                `, 'scale', 'warning');

                html += DecisionNode(
                    "Conseguimos garantir Confusão, SUTVA e Positividade?",
                    { label: "Sim", action: "setState({assumptionsMet: true})" },
                    { label: "Não", action: "setState({assumptionsMet: false})" },
                    state.assumptionsMet
                );

                if (state.assumptionsMet === true) {
                    html += Connector();
                    html += Step("Métodos Simples de Ajuste", "Como as premissas são razoáveis, podemos controlar as variáveis.", `
                        <ul class="text-xs list-disc list-inside mt-2 space-y-1">
                            <li>Regressão Linear/Logística</li>
                            <li>Matching (Pareamento)</li>
                            <li>IPW (Inverse Probability Weighting)</li>
                        </ul>
                    `, 'settings', 'success');
                } else if (state.assumptionsMet === false) {
                    html += Connector();
                    html += Step("Métodos Quasi-Experimentais", "Quando há confusão não observada, buscamos variações 'quase aleatórias'.", `
                        <ul class="text-xs list-disc list-inside mt-2 space-y-1">
                            <li>Variáveis Instrumentais (IV)</li>
                            <li>Difference-in-Differences (DiD)</li>
                            <li>Regressão Descontínua (RDD)</li>
                        </ul>
                    `, 'zap', 'error');
                }
            } else {
                resetBtn.classList.add('hidden');
            }

            app.innerHTML = html;
            // Reinicializa os ícones da Lucide após atualizar o HTML
            lucide.createIcons();
        }

        // Inicialização
        window.onload = render;
    </script>
</body>
</html>